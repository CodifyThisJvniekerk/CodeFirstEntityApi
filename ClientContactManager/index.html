<!DOCTYPE html>
<html>
<head>
    <title id="titHeader"> Customer Manager </title>
	<meta charset="utf-8" />
    
    <script src="scripts/jquery-3.1.0.min.js"></script>
    <link href="App_Themes/Bootstrap/bootstrap.min.css" rel="stylesheet" />
    <link href="App_Themes/Bootstrap/bootstrap.css" rel="stylesheet" />
    <script>
        var custcontactID = 0;
        var customerID = 0;
        var url = '/api/customers/GetCustomers';
        function getCustomers() {
            url = '/api/customers/GetCustomers';
            $('#Customers').children().remove();
            $('#Customers').show();
            $('#customerform').hide();
            $('<tr><td>Name</td><td>Latitude</td><td>Longitude</td><td></td></tr>').appendTo($('#Customers'));
            $(function () {
                $.getJSON(url, function (data) {
                    console.log(data);
                    //for (item in data) {
                    for (var item = 0; item < data.length; ++item) {
                        $('<tr><td>' + data[item].Name + '</td><td>' + data[item].Latitude + '<td>' + data[item].Longitude + '</td>' + "</td><td> <input type='button' onclick='loadCustomer(" + data[item].ID + ");' value='edit'/>" + "<input type='button' onclick='loadCustomerContactForm(" + data[item].ID + ");' value='manage contacts' />" + '</td></tr>').appendTo($('#Customers'))
                    }
                });
            });
        }
        function getCustomerByName() {
            url = '/SearchForCustomerByName/'
            $('#Customers').show();
            $('#Customers').children().remove();
            $('<tr><td>Name</td><td>Latitude</td><td>Longitude</td><td></td></tr>').appendTo($('#Customers'));
            $(function () {
                $.getJSON(url + '/'+ $('#txtCustSearck').val(), function (data) {
                    console.log(data);
                    //for (item in data) {
                    for (var item = 0; item < data.length; ++item) {
                        $('<tr><td>' + data[item].Name + '</td><td>' + data[item].Latitude + '<td>' + data[item].Longitude + '</td>' + "</td><td> <input type='button' onclick='loadCustomer(" + data[item].ID + ");' value='edit'/>" + "<input type='button' onclick='loadCustomerContactForm(" + data[item].ID + ");' value='Manage Contacts' />" + '</td></tr>').appendTo($('#Customers'));
                    }
                });
            });
        }
        function showCustomerForm(id) {
            if (id > 0) {

            } else {
                $('#customerform').show();
                $('#Customers').hide();
                $('#txtID').val("");
            }
        }
        function addEditCustomer() {
            if ($('#txtID').val() == "")
            {
                if ($('#txtCustName').val().trim() !== "") {
                    if ($.isNumeric($('#txtCustLatitude').val()) && $.isNumeric($('#txtCustLongitude').val())) {
                        $.ajax({
                            type: "PUT",
                            url: "AddCustomer/" + $('#txtCustName').val() + '/' + $('#txtCustLatitude').val() + '/' + $('#txtCustLongitude').val(),
                            //data: JSON.stringify({ Nane: $('#txtCustName').val(), latitude: $('#txtCustLatitude').val(), Longitude:  $('#txtCustLongitude').val()}),
                            contentType: "application/json; charset=utf-8",
                            dataType: "json",
                            error: function (XMLHttpRequest, textStatus, errorThrown) {
                            },
                            success: function (result) {
                                alert('customer saved.');
                            }
                            });
                    } else {
                        alert('Please ensure both the longitude and latitude is numerical.');
                    }
                } else {
                    alert('Please enter an customer name.');
                }
            } else {
                if ($('#txtCustName').val().trim() !== "") {
                    if ($.isNumeric($('#txtCustLatitude').val()) && $.isNumeric($('#txtCustLongitude').val())) {
                        $.ajax({
                            type: "PUT",
                            url: "UpdateCustomer/" + $('#txtID').val() + '/' + $('#txtCustName').val() + '/' + $('#txtCustLatitude').val() + '/' + $('#txtCustLongitude').val(),
                            //data: JSON.stringify({ Nane: $('#txtCustName').val(), latitude: $('#txtCustLatitude').val(), Longitude:  $('#txtCustLongitude').val()}),
                            contentType: "application/json; charset=utf-8",
                            dataType: "json",
                            error: function (XMLHttpRequest, textStatus, errorThrown) {
                            },
                            success: function (result) {
                                alert('customer saved.');
                            }
                        });
                    } else {
                        alert('Please ensure both the longitude and latitude is numerical.');
                    }
                } else {
                    alert('Please enter an customer name.');
                }
            }
            $('#Customers').hide();
            $('#customerform').hide();
            
        }
        function loadCustomer(id) {
            url = '/api/customers/GetCustomerByID/' + id
            $(function () {
                $.getJSON(url, function (data) {
                    console.log(data);
                    console.log(data.ID + ' ' + data.Name + ' ' + data.Latitude + ' ' + data.Longitude);
                    $('#customerform').show();
                    $('#Customers').hide();
                    $('#txtCustName').val(data.Name);
                    $('#txtCustLatitude').val(data.Latitude);
                    $('#txtCustLongitude').val(data.Longitude);
                    $('#txtID').val(id);
                });
            });
        }
        //Customer Contact Section Start
        function loadCustomerContactForm(custid) {
            
            customerID = custid;
            url = '/api/customers/GetCustomerByID/' + custid;
            $('#divCustomerForm').hide();
            $('#divCustomerContactsForm').show();
            $(function () {
                $.getJSON(url, function (data) {
                    console.log(data);
                    success: $('#customercontactsHeader').text(data.Name + "'s Contacts");
                })
            });
            setTimeout(function () { getCustomerContacts(custid) }, 500);
            
        }
        function getCustomerContacts(custid) {
            console
            $('#CustomerContacts').children().remove();
            $('<tr><td>Name</td><td>Contact Number</td><td>Email</td><td></td></tr>').appendTo($('#CustomerContacts'));
            url = '/api/CustomerContacts/GetCustomerContacts/' + custid
            $(function () {
                $.getJSON(url, function (data) {
                    console.log(data);
                    for (var x = 0; x < data.length; ++x) {
                        $('<tr><td>' + data[x].Name + '</td><td>' + data[x].ContactNumber + '<td>' + data[x].Email + '</td>' + "</td><td> <input type='button' onclick='loadCustomerContactForm(" + data[x].ID + ");' value='edit'/>" + + '</td></tr>').appendTo($('#CustomerContacts'))
                    }
                });
            });
        }
        function showCustomerContactForm(custid,customercontactID) {
            if (customercontactID > 0) {
                //Update/Edit load customer contact information
                url = '/api/CustomerContacts/GetCustomerContact/' + customercontactID;
                $(function () {
                    $.getJSON(url, function (data) {
                        console.log(data);
                        success: $('#customercontactsHeader').text(data.Name + "'s Contacts");
                    })
                });
            } else {
                //Add/Insert show customer contact form clear text boxes
                customercontactID = 0;
                $('#txtCustContactName').text("");
                $('#txtCustContactnum').text("");
                $('#txtCustContactEmail').text("");
            }
            $('#tblcustomercontactform').show();
            $('#CustomerContacts').hide();
        }
        function addEditCustomerContacts(custid, customercontactID) {
            var isvalid = false
            if ($('#txtCustContactName').val().trim() !== "") {
                if ($('#txtCustContactEmail').val().trim() !== "") {
                    if ($('#txtCustContactnum').val().trim() !== "") {
                        isvalid = true;
                    } else {
                        alert('Please enter an valid contact number.');
                    }
                } else {
                    alert('Please enter an valid email address.');
                }
            } else {
                alert('Please enter an customer name.');
            }
            if (isvalid === true) {
                if (customercontactID > 0) {
                    //Update/Edit
                    //alert('edit');

                } else {
                    //Add/Insert
                    //alert('add');
                    addCustomerContact($('#txtCustContactName').val(), $('#txtCustContactEmail').val(), $('#txtCustContactnum').val(), custid);
                }
            }
            
        }
        function addCustomerContact(name, email, contactnum, customerID){
            $.ajax({
                type: "PUT",
                url: "/api/CustomerContacts/AddCustomerContact/" + name + "/" + email + "/" + contactnum + "/" + customerID,
                //data: JSON.stringify({ Nane: $('#txtCustName').val(), latitude: $('#txtCustLatitude').val(), Longitude:  $('#txtCustLongitude').val()}),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert(errorThrown);
                },
                success: function (result) {
                    alert('customer contact saved.');
                }
            });
        }

        //Customer Contact Section END
    </script>
</head>
<body onload="getCustomers();">
    <div id="divCustomerForm">
        <h1 class="page-header"> Customers </h1> <div style="display:inline; width:100%;">
            <input type="search" class="text-primary" id="txtCustSearck" />
            <input type="button" id="btnSearch" class="btn-info" value="Search" onclick="getCustomerByName();" />
            <input type="button" value="Add Customer" class="btn-info" onclick="showCustomerForm(0);" />
            <input type="button" value="Show All" class="btn-info" onclick="getCustomers();" />
        </div>
        <table id="Customers" style="width:100%" class="table-striped">
            <tr>
                <td></td>
            </tr>
        </table>
        <table id="customerform" style="display:none; width:50%" class="">
            <tr>
                <td>Name:</td>
                <td><input type="text" id="txtCustName" /><input type="text" id="txtID" style="visibility:hidden;"></td>
            </tr>
            <tr>
                <td>Latitude</td>
                <td><input type="text" id="txtCustLatitude" /></td>
            </tr>
            <tr>
                <td>Longitude</td>
                <td><input type="text" id="txtCustLongitude" /></td>
            </tr>
            <tr>
                <td><input type="button" class="btn-info" value="Save" onclick="addEditCustomer();" /></td>
                <td></td>
            </tr>
        </table>
    </div>
    <div id="divCustomerContactsForm" style="display:none;">
        
        <h1 id="customercontactsHeader" class="page-header"> Contacts </h1> <div style="display:inline; width:100%">
            <input type="search" class="text-primary" id="txtCustSearck" />
            <input type="button" id="btnSearch" class="btn-info" value="Search" onclick="getCustomerContactByName(customerID);" />
            <input type="button" value="Add Contact" class="btn-info" onclick="showCustomerContactForm(0, customerID);" />
            <input type="button" value="Show All" class="btn-info" onclick="getCustomerContacts(customerID);" />
        </div>
        <table id="CustomerContacts" style="width:100%" class="table-striped">
            <tr>
                <td></td>
            </tr>
        </table>
        <table id="tblcustomercontactform" style="display:none; width:50%" class="">
            <tr>
                <td>Name:</td>
                <td><input type="text" id="txtCustContactName" /><input type="text" id="txtID" style="visibility:hidden;"></td>
            </tr>
            <tr>
                <td>Contact Number</td>
                <td><input type="tel" id="txtCustContactnum" /></td>
            </tr>
            <tr>
                <td>Email </td>
                <td><input type="email" id="txtCustContactEmail" /></td>
            </tr>
            <tr>
                <td><input type="button" class="btn-info" value="Save Contact" onclick="addEditCustomerContacts(customerID, custcontactID);" /></td>
                <td></td>
            </tr>
        </table>

    </div>

</body>
</html>
